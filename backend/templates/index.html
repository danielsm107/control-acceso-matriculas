{% extends "base.html" %}
{% block content %}

{% if current_user.rol != 'admin' %}
<h2 class="text-white mt-5 mb-3">Mis Matrículas Registradas</h2>
<table class="table-modern">
  <thead>
    <tr>
      <th onclick="sortTable(0, this)">Número <span class="sort-icon">⇅</span></th>
      <th onclick="sortTable(1, this)">Matrícula <span class="sort-icon">⇅</span></th>
      <th onclick="sortTable(2, this)">Estado <span class="sort-icon">⇅</span></th>
    </tr>
  </thead>
  <tbody>
    {% for id, matricula, estado in matriculas %}
    <tr>
      <td>{{ loop.index }}</td>
      <td>{{ matricula }}</td>
      <td>
        <span class="status-badge 
          {% if estado == 'autorizada' %}authorized
          {% elif estado == 'pendiente' %}pending
          {% else %}denied{% endif %}">
          {{ estado|capitalize }}
        </span>
      </td>
    </tr>
    {% endfor %}
  </tbody>
</table>
{% endif %}
</div>
{% endblock %}


{% block scripts %}
<script>
let lastSortedColumn = null;
let lastSortDirection = 'asc';

function sortTable(colIndex, thElement) {
  const table = document.querySelector(".table-modern tbody");
  const rows = Array.from(table.rows);
  const isNumeric = !isNaN(rows[0].cells[colIndex].innerText.trim());

  const shouldReverse = lastSortedColumn === colIndex && lastSortDirection === 'asc';
  lastSortedColumn = colIndex;
  lastSortDirection = shouldReverse ? 'desc' : 'asc';

  const sortedRows = rows.sort((a, b) => {
    const aText = a.cells[colIndex].innerText.trim().toLowerCase();
    const bText = b.cells[colIndex].innerText.trim().toLowerCase();
    return shouldReverse ? bText.localeCompare(aText) : aText.localeCompare(bText);
  });

  table.innerHTML = '';
  sortedRows.forEach(row => table.appendChild(row));

  document.querySelectorAll(".sort-icon").forEach(i => i.textContent = '⇅');
  thElement.querySelector(".sort-icon").textContent = shouldReverse ? '↓' : '↑';
}
</script>
{% endblock %}
