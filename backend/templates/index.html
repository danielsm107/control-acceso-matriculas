{% extends "base.html" %}
{% block content %}

{% if current_user.rol != 'admin' %}
<div class="d-flex align-items-center gap-4 mb-5 p-4">
  <div class="text-white">
    <h2 class="mb-0">Bienvenido, {{ current_user.nombre }}</h2>
    <p class="mb-0">
      <i class="fas fa-envelope me-2"></i>{{ current_user.email }}
    </p>
  </div>
</div>

<div class="container">
  <h2 class="text-white mb-3">Mis Matrículas Registradas</h2>
  <table class="table-modern w-100">
    <thead>
      <tr>
        <th onclick="sortTable(0, this)">Matrícula <span class="sort-icon">⇅</span></th>
        <th onclick="sortTable(1, this)">Estado <span class="sort-icon">⇅</span></th>
      </tr>
    </thead>
    <tbody>
      {% for matricula, estado in matriculas %}
      <tr>
        <td>{{ matricula }}</td>
        <td>
          <span class="status-badge 
            {% if estado == 'autorizada' %}authorized
            {% elif estado == 'pendiente' %}pending
            {% else %}denied{% endif %}">
            {{ estado|capitalize }}
          </span>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>
{% endif %}

{% endblock %}

{% block scripts %}
<script>
let lastSortedColumn = null;
let lastSortDirection = 'asc';

function sortTable(colIndex, thElement) {
  const table = document.querySelector(".table-modern tbody");
  const rows = Array.from(table.rows);

  const shouldReverse = lastSortedColumn === colIndex && lastSortDirection === 'asc';
  lastSortedColumn = colIndex;
  lastSortDirection = shouldReverse ? 'desc' : 'asc';

  const sortedRows = rows.sort((a, b) => {
    const aText = a.cells[colIndex].textContent.trim().toLowerCase();
    const bText = b.cells[colIndex].textContent.trim().toLowerCase();
    return shouldReverse ? bText.localeCompare(aText) : aText.localeCompare(bText);
  });

  table.innerHTML = '';
  sortedRows.forEach(row => table.appendChild(row));

  document.querySelectorAll(".sort-icon").forEach(i => i.textContent = '⇅');
  thElement.querySelector(".sort-icon").textContent = shouldReverse ? '↓' : '↑';
}
</script>
{% endblock %}
