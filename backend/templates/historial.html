<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Historial de Accesos</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
  <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
</head>
<body class="container mt-5">
  <h2 class="mb-4">Historial de Accesos <span id="estado-ws" class="badge bg-secondary">Conectando...</span></h2>
  <table class="table table-bordered">
    <thead class="table-dark">
      <tr>
        <th>Matr√≠cula</th>
        <th>Fecha</th>
        <th>Estado</th>
        <th>Mensaje</th>
      </tr>
    </thead>
    <tbody id="tabla-accesos">
      <!-- Las filas se insertar√°n autom√°ticamente con Socket.IO -->
    </tbody>
  </table>

  <a href="/" class="btn btn-primary">Volver</a>

  <script>
    const estadoWS = document.getElementById("estado-ws");
    const tabla = document.getElementById("tabla-accesos");

    const socket = io({
      path: "/socket.io"
    });

    socket.on("connect", () => {
      estadoWS.textContent = "üü¢ Conectado";
      estadoWS.className = "badge bg-success";
    });

    socket.on("disconnect", () => {
      estadoWS.textContent = "üî¥ Desconectado";
      estadoWS.className = "badge bg-danger";
    });

    socket.on("nuevo_acceso", (acceso) => {
      const fila = document.createElement("tr");

      const estadoTexto = acceso.autorizado ? "‚úÖ Autorizado" : "‚ùå Denegado";
      const mensaje = acceso.autorizado ? "Acceso permitido" : "Acceso denegado";

      fila.innerHTML = `
        <td>${acceso.matricula}</td>
        <td>${acceso.fecha}</td>
        <td class="${acceso.autorizado ? 'text-success' : 'text-danger'}">${estadoTexto}</td>
        <td class="${acceso.autorizado ? 'text-success' : 'text-danger'}">${mensaje}</td>
      `;

      tabla.prepend(fila); // a√±ade la nueva fila al principio
  </script>
</body>
</html>

