<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Historial de Accesos</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
</head>
<body class="container mt-5">
  <h2 class="mb-4">Historial de Accesos</h2>

  <table class="table table-bordered">
    <thead class="table-dark">
      <tr>
        <th>Matrícula</th>
        <th>Fecha</th>
        <th>Estado</th>
        <th>Mensaje</th>
      </tr>
    </thead>
    <tbody id="tabla-accesos">
      <!-- Filas insertadas dinámicamente con JavaScript -->
    </tbody>
  </table>

  <a href="/" class="btn btn-primary">Volver</a>

  <script>
    function cargarHistorial() {
      fetch("/api/historial")
        .then(response => response.json())
        .then(data => {
          const tabla = document.getElementById("tabla-accesos");
          tabla.innerHTML = "";

          data.forEach(acceso => {
            const fila = document.createElement("tr");

            const estadoTexto = acceso.autorizado ? "✅ Autorizado" : "❌ Denegado";
            const mensaje = acceso.autorizado ? "Acceso permitido" : "Acceso denegado";

            fila.innerHTML = `
              <td>${acceso.matricula}</td>
              <td>${acceso.fecha}</td>
              <td class="${acceso.autorizado ? 'text-success' : 'text-danger'}">${estadoTexto}</td>
              <td class="${acceso.autorizado ? 'text-success' : 'text-danger'}">${mensaje}</td>
            `;
            tabla.appendChild(fila);
          });
        })
        .catch(err => console.error("Error al cargar historial:", err));
    }

    setInterval(cargarHistorial, 5000); // Actualiza cada 5 segundos
    window.onload = cargarHistorial;
  </script>
</body>
</html>

